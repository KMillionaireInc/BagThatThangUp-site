<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BagThat Onboarding</title>
<style>
  body {
    font-family: sans-serif;
    background: #f7f5f0;
    color: #333;
    padding: 2rem;
    max-width: 480px;
    margin: auto;
  }
  form {
    background: #fff;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  label {
    font-weight: 600;
    margin-top: 1rem;
    display: block;
  }
  input {
    width: 100%;
    padding: .6rem;
    margin-top: .3rem;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  button {
    margin-top: 1.5rem;
    width: 100%;
    padding: .8rem;
    background: #c19a6b;
    border: none;
    border-radius: 6px;
    color: white;
    font-size: 1rem;
    cursor: pointer;
  }
  button:hover {
    background: #aa875c;
  }
</style>
</head>
<body>

<h1>Set Up Your Storefront</h1>

<form id="onboard-form">
  <label>Store Name</label>
  <input name="site_display_name" required>

  <label>Desired Domain (no spaces or symbols)</label>
  <input name="subdomain" required>

  <label>Amazon Store ID</label>
  <input name="amazon_tag" required>

  <label>Email Address</label>
  <input name="email" type="email" required>

  <button type="submit">Bag That</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("onboard-form");

  form.addEventListener("submit", async e => {
    e.preventDefault();

    const data = {
      site_display_name: form.site_display_name.value.trim(),
      subdomain: form.subdomain.value.trim().toLowerCase(),
      amazon_tag: form.amazon_tag.value.trim(),
      email: form.email.value.trim()
    };

    // Your existing webhook endpoint
    const webhookUrl = "https://script.google.com/macros/s/AKfycbxbAn0Lat0Mr31nk7LIEvgTkaEguQ0VbkYAdnxfteh6MIBkkuC7oge5vRlpFK8-SYqjEw/exec";

    try {
      const res = await fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();

      if (result.error === "duplicate_subdomain") {
        document.body.innerHTML = `
          <div style="text-align:center;padding:3rem;">
            <h2>That domain name is already taken.</h2>
            <button onclick="window.location.reload()">Try Again</button>
          </div>`;
      } 
      else if (result.success && result.link) {
        // FIX: Auto-redirect to tenant site
        window.location.href = result.link;
      } 
      else {
        document.body.innerHTML = `<h2 style="text-align:center;">Error: ${result.error || 'Unknown error'}</h2>`;
      }
    } 
    catch (err) {
      console.error(err);
      document.body.innerHTML = `<h2 style="text-align:center;">Server error. Try again later.</h2>`;
    }
  });
});
</script>

</body>
</html>
