<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BagThat Success</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#faf9f7;color:#222;text-align:center;padding:40px;}
    .card{background:#fff;padding:40px;border-radius:16px;max-width:600px;margin:40px auto;box-shadow:0 10px 20px rgba(0,0,0,.08);}
    h1{color:#2e7d32;font-size:28px;margin-bottom:16px;}
    p{font-size:16px;line-height:1.6;}
    a.btn{display:inline-block;margin-top:20px;padding:12px 24px;background:#0070f3;color:#fff;text-decoration:none;border-radius:8px;font-weight:600;}
    .error{color:#d32f2f;margin-top:12px;}
  </style>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const supabase = createClient("https://YOUR_PROJECT.supabase.co", "YOUR_PUBLIC_ANON_KEY");

    async function loadTenant() {
      // pull latest user (or match by email passed in querystring if available)
      const params = new URLSearchParams(window.location.search);
      const email = params.get("email");

      let { data, error } = email
        ? await supabase.from("Users").select("subdomain").eq("email", email).single()
        : await supabase.from("Users").select("subdomain").order("created_at", { ascending: false }).limit(1).single();

      let html = "";
      if (data && data.subdomain) {
        const url = `https://${data.subdomain}.bagthatthangup.com`;
        html = `<p>Your storefront is ready:</p>
                <a class="btn" href="${url}">Visit Your Store</a>`;
      } else {
        html = `<p class="error">We could not find your store link. Please check your email or contact support.</p>`;
      }
      document.getElementById("storeLink").innerHTML = html;
    }

    loadTenant();
  </script>
</head>
<body>
  <div class="card">
    <h1>ðŸŽ‰ Success!</h1>
    <p>Your storefront has been created.</p>
    <div id="storeLink"></div>
    <p>Check your email for setup details and next steps.</p>
    <p>If you need help, contact <a href="mailto:support@bagthatthangup.com">support@bagthatthangup.com</a></p>
  </div>
</body>
</html>
