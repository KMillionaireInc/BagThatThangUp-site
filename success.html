<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BagThat â€“ Success</title>
<style>
body{font-family:sans-serif;background:#f7f5f0;color:#333;padding:2rem;max-width:600px;margin:auto;text-align:center}
.card{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h1{color:#2d6a4f}
a.btn{display:inline-block;margin-top:1.5rem;padding:.8rem 1.2rem;background:#c19a6b;color:#fff;border-radius:6px;text-decoration:none}
a.btn:hover{background:#aa875c}
</style>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
<div class="card">
  <h1>ðŸŽ‰ Success! Your store setup is underway.</h1>
  <p id="next"></p>
  <p><strong>Your storefront link:</strong></p>
  <p id="link">Loading your linkâ€¦</p>
  <a id="cta" class="btn" style="display:none;" target="_blank">Visit Your Storefront</a>
  <p style="margin-top:2rem;font-size:.9rem;color:#666">
    Need help? <a href="mailto:support@bagthatthangup.com">Contact support</a>.
  </p>
</div>

<script>
const SUPABASE_URL = "https://gmsjqunfsffjiksffvem.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdtc2pxdW5mc2Zmamlrc2ZmdmVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4NzIxNTgsImV4cCI6MjA3NjQ0ODE1OH0.7qEXKk8f8Sd3G2y8KyQ0XbeCyG8ieD-8WV18-_JkRGc";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// get ID from query string
const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get("id") || sessionStorage.getItem("tenant_id");

async function loadTenant() {
  if (!id) {
    document.getElementById("link").innerText = "Error: No tenant ID found.";
    return;
  }
  const { data, error } = await supabase.from("Users").select("subdomain").eq("id", id).single();

  if (error || !data) {
    document.getElementById("link").innerText = "Error loading your storefront link.";
  } else {
    const subdomain = data.subdomain;
    const url = `https://${subdomain}.bagthatthangup.com`;
    document.getElementById("link").innerText = url;
    document.getElementById("cta").href = url;
    document.getElementById("cta").style.display = "inline-block";
    document.getElementById("next").innerText = "Your store is being provisioned. You can bookmark or share this link now.";
  }
}

loadTenant();
</script>
</body>
</html>
