<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Success â€“ BagThat</title>
<style>
  body{font-family:sans-serif;background:#f7f5f0;color:#333;padding:2rem;max-width:600px;margin:auto;text-align:center}
  .card{background:#fff;padding:2.5rem;border-radius:14px;box-shadow:0 6px 14px rgba(0,0,0,.1)}
  h1{color:#2e7d32;margin-bottom:1rem}
  p{margin:.75rem 0}
  a.store-link{display:inline-block;margin-top:1.5rem;padding:1rem 2rem;background:#c19a6b;color:#fff;text-decoration:none;border-radius:8px;font-weight:600;font-size:1.1rem}
  a.store-link:hover{background:#aa875c}
</style>
</head>
<body>
<div class="card">
  <h1>ðŸŽ‰ Success!</h1>
  <p>Your storefront has been created.</p>
  <div id="storeLinkMessage">Loading your link...</div>
  <p style="margin-top:2rem;">Check your email for setup details and next steps.</p>
  <p>If you need help, contact <a href="mailto:support@bagthatthangup.com">support@bagthatthangup.com</a></p>
</div>

<script>
function readCookie(name){
  const m = document.cookie.match(new RegExp('(?:^|; )'+name.replace(/([.$?*|{}()\\[\\]\\\\\\/\\+^])/g,'\\$1')+'=([^;]*)'));
  return m ? decodeURIComponent(m[1]) : null;
}

document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(location.search);
  let sub = params.get("subdomain")
           || sessionStorage.getItem("bagthat_sub")
           || localStorage.getItem("bagthat_sub")
           || readCookie("bagthat_sub");

  // simple sanitize
  if (sub && !/^[a-z0-9-]+$/.test(sub)) sub = null;

  if (sub) {
    const url = `https://${sub}.bagthatthangup.com`;
    document.getElementById("storeLinkMessage").innerHTML = `
      <p><strong>Your storefront is live at:</strong></p>
      <a href="${url}" class="store-link" target="_blank" rel="noopener">${url}</a>
      <p style="margin-top:1rem;">Click above to visit your store now.</p>
    `;
  } else {
    document.getElementById("storeLinkMessage").innerHTML =
      "<p style='color:#b00020;'>We could not find your store link. Please check your email or contact support.</p>";
  }
});
</script>
</body>
</html>
