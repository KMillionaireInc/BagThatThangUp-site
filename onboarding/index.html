<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BagThat Onboarding — Launch Your Storefront</title>
  <link rel="icon" href="../custompro.png"/>
  <style>
    :root {
      --teal:#008080;
      --coral:#ff6b6b;
      --gold:#f5cba7;
      --offwhite:#f9fafb;
      --charcoal:#1f2937;
      --radius:16px;
      --shadow:0 10px 24px rgba(0,0,0,0.1);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--offwhite);
      color:var(--charcoal);
      line-height:1.6;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:100vh;
      padding:40px 20px;
    }
    .wrapper{
      background:white;
      box-shadow:var(--shadow);
      border-radius:var(--radius);
      max-width:700px;
      width:100%;
      padding:60px 50px;
    }
    h1{
      text-align:center;
      color:var(--teal);
      margin-bottom:20px;
      font-size:2rem;
    }
    p.desc{
      text-align:center;
      color:#555;
      margin-bottom:40px;
      font-size:1.1rem;
    }
    form{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
    }
    label{
      font-weight:600;
      font-size:.95rem;
    }
    input{
      width:100%;
      padding:12px;
      margin-top:6px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:1rem;
      transition:border .2s;
    }
    input:focus{outline:none;border-color:var(--teal);}
    .full{grid-column:1/3;}
    .status{
      grid-column:1/3;
      text-align:center;
      font-weight:600;
      margin:10px 0;
    }
    button{
      grid-column:1/3;
      padding:15px;
      font-size:1.1rem;
      background:var(--teal);
      color:white;
      border:none;
      border-radius:8px;
      cursor:pointer;
      transition:background .3s;
    }
    button:hover{background:var(--coral);}
    footer{
      text-align:center;
      font-size:.9rem;
      color:#666;
      margin-top:30px;
    }
  </style>
</head>
<body>

<div class="wrapper">
  <h1>Set Up Your Storefront</h1>
  <p class="desc">Enter your details below to generate your branded BagThat site.</p>
  <form id="onboardForm">
    <div>
      <label>First Name</label>
      <input type="text" id="first_name" required />
    </div>
    <div>
      <label>Last Name</label>
      <input type="text" id="last_name" required />
    </div>
    <div class="full">
      <label>Email</label>
      <input type="email" id="email" required />
    </div>
    <div class="full">
      <label>Store Name</label>
      <input type="text" id="store_name" placeholder="Ex: Keisha’s Finds" required />
    </div>
    <div class="full">
      <label>Preferred Subdomain</label>
      <input type="text" id="subdomain" placeholder="Ex: keishasfinds" required />
      <small id="domainStatus" style="color:#666;font-size:.9rem;"></small>
    </div>
    <div class="full">
      <label>Amazon Associates ID</label>
      <input type="text" id="amz_id" placeholder="Ex: keisha-20" required />
    </div>
    <input type="hidden" id="plan" value="basic" />
    <div id="status" class="status"></div>
    <button type="submit">Launch My Storefront</button>
  </form>
  <footer>© 2025 BagThat. All rights reserved.</footer>
</div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

  // TODO: Replace these with your real Supabase values
  const supabaseUrl = "https://YOURPROJECT.supabase.co"
  const supabaseAnonKey = "YOUR_ANON_KEY"
  const supabase = createClient(supabaseUrl, supabaseAnonKey)

  const form = document.getElementById("onboardForm")
  const domainStatus = document.getElementById("domainStatus")
  const statusBox = document.getElementById("status")
  const subdomainInput = document.getElementById("subdomain")

  // Check subdomain availability in real time
  subdomainInput.addEventListener("input", async e => {
    const val = e.target.value.trim().toLowerCase()
    if (!val) return domainStatus.textContent = ""
    const { data, error } = await supabase.from("tenants").select("subdomain").eq("subdomain", val)
    if (error) {
      domainStatus.textContent = "Error checking name."
      domainStatus.style.color = "red"
    } else if (data.length > 0) {
      domainStatus.textContent = "This subdomain is already taken."
      domainStatus.style.color = "red"
    } else {
      domainStatus.textContent = "Available ✓"
      domainStatus.style.color = "green"
    }
  })

  form.addEventListener("submit", async (e) => {
    e.preventDefault()
    statusBox.textContent = "Submitting..."
    const record = {
      first_name: form.first_name.value.trim(),
      last_name: form.last_name.value.trim(),
      email: form.email.value.trim(),
      store_name: form.store_name.value.trim(),
      subdomain: form.subdomain.value.trim().toLowerCase(),
      amz_id: form.amz_id.value.trim(),
      plan: form.plan.value
    }
    const { data, error } = await supabase.from("tenants").insert([record])
    if (error) {
      statusBox.textContent = "Error: " + error.message
      statusBox.style.color = "red"
    } else {
      statusBox.textContent = "Success! Redirecting..."
      statusBox.style.color = "green"
      setTimeout(()=>{
        window.location.href = `/success/?subdomain=${record.subdomain}`
      }, 1200)
    }
  })
</script>
</body>
</html>
