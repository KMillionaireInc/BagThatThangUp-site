<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BagThat â€“ Activate Your Store</title>
<style>
  body {
    background:#f8f4ef; color:#4a3728; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    display:flex; align-items:center; justify-content:center; height:100vh; margin:0;
  }
  form {
    background:#fffaf6; padding:40px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.08);
    width:360px; text-align:center;
  }
  h1 { color:#8b5e3c; font-size:1.8rem; margin-bottom:1.5rem; }
  label { display:block; font-weight:600; text-align:left; margin:10px 0 5px; }
  input {
    width:100%; padding:10px 12px; border:1px solid #d7c6b5; border-radius:8px;
    font-size:15px; margin-bottom:10px;
  }
  button {
    background:#b37a4c; color:#fff; font-weight:600; font-size:1rem;
    border:none; border-radius:10px; padding:12px 20px; width:100%;
    cursor:pointer; transition:.2s;
  }
  button:hover { background:#9a653b; }
  small { display:block; font-size:.85rem; color:#8b5e3c; margin-bottom:15px; }
</style>
</head>
<body>

<form id="bagthatForm" action="https://hook.us2.make.com/YOUR_MAIN_ONBOARDING_WEBHOOK" method="POST">
  <h1>BagThat</h1>

  <label>Desired Site Name</label>
  <input type="text" name="site_display_name" required>

  <label>Desired Site Domain</label>
  <input type="text" name="subdomain" required>
  <small>Your site will appear at: <strong>sitename.bagthatthangup.com</strong></small>

  <label>Amazon Store ID</label>
  <input type="text" name="amazon_tag" required>

  <label>Email Address</label>
  <input type="email" name="email" required>

  <button type="submit">Activate My Store</button>
</form>

<script>
document.getElementById("bagthatForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const form = e.target;
  const subdomainField = form.querySelector("input[name='subdomain']");
  const subdomain = subdomainField.value.trim().toLowerCase();

  if (!subdomain) {
    alert("Please enter a domain name.");
    return;
  }

  // *** CHANGE THIS URL to your Make domain-check webhook ***
  const checkUrl = "https://hook.us2.make.com/YOUR_DOMAIN_CHECK_WEBHOOK";

  try {
    const res = await fetch(checkUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ subdomain })
    });

    const result = await res.json();

    if (result.exists) {
      alert(`The domain name "${subdomain}" is already taken. Please choose another.`);
      subdomainField.focus();
      return;
    }

    // if unique, submit to main webhook
    form.submit();

  } catch (err) {
    alert("Something went wrong checking the domain. Please try again.");
    console.error(err);
  }
});
</script>

</body>
</html>
