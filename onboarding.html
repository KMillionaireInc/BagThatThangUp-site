<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BagThat Onboarding</title>
<style>
body{font-family:sans-serif;background:#f7f5f0;color:#333;padding:2rem;max-width:480px;margin:auto}
form{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
label{font-weight:600;margin-top:1rem;display:block}
input{width:100%;padding:.6rem;margin-top:.3rem;border:1px solid #ccc;border-radius:6px}
button{margin-top:1.5rem;width:100%;padding:.8rem;background:#c19a6b;border:none;border-radius:6px;color:white;font-size:1rem;cursor:pointer}
button:hover{background:#aa875c}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
</head>
<body>
<h1>Set Up Your Storefront</h1>
<form id="onboard-form">
  <label>First Name</label>
  <input name="first_name" required>
  <label>Last Name</label>
  <input name="last_name" required>
  <label>Store Name</label>
  <input name="site_name" required>
  <label>Desired Domain (no spaces or symbols)</label>
  <input name="subdomain" required>
  <label>Amazon Store ID</label>
  <input name="amazon_id" required>
  <label>Email Address</label>
  <input name="email" type="email" required>
  <button type="submit">Submit</button>
</form>

<script>
const SUPABASE_URL = 'https://gmsjqunfsffjiksffvem.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'; // your anon key

const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("onboard-form");
  form.addEventListener("submit", async e => {
    e.preventDefault();
    const data = {
      first_name: form.first_name.value.trim(),
      last_name: form.last_name.value.trim(),
      site_name: form.site_name.value.trim(),
      subdomain: form.subdomain.value.trim().toLowerCase(),
      amazon_id: form.amazon_id.value.trim(),
      email: form.email.value.trim()
    };

    const { error } = await client.from('Users').insert([data]);

    if (error) {
      document.body.innerHTML = `<h2 style="text-align:center;color:#b00020;">Error: ${error.message}</h2>`;
    } else {
      // redirect to success with subdomain in query string
      window.location.href = "success.html?subdomain=" + encodeURIComponent(data.subdomain);
    }
  });
});
</script>
</body>
</html>
