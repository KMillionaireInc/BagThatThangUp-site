<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Onboarding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Dark background */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-[#161b22] p-8 rounded-xl shadow-2xl border border-[#30363d]">
        <h1 class="text-3xl font-bold text-white mb-6">SaaS Onboarding</h1>
        <p class="text-gray-400 mb-6">Enter your site details to register and proceed to payment.</p>

        <form id="onboardingForm" class="space-y-6">

            <!-- Site Name -->
            <div>
                <label for="displayName" class="block text-sm font-medium text-gray-300 mb-1">1. Site Name (e.g., "The Best Gadgets")</label>
                <input type="text" id="displayName" name="displayName" placeholder='Site Name (e.g., "The Best Gadgets")' required class="w-full px-4 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150">
            </div>

            <!-- Subdomain -->
            <div>
                <label for="domainName" class="block text-sm font-medium text-gray-300 mb-1">2. Desired Subdomain (e.g., "bestgadgets" for bestgadgets.saas.com)</label>
                <div class="relative">
                    <span class="absolute left-0 top-0 mt-3 ml-3 text-gray-500">/</span>
                    <input type="text" id="domainName" name="domainName" placeholder="Subdomain (e.g., 'bestgadgets')" required class="w-full pl-6 pr-4 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150">
                </div>
            </div>

            <!-- Amazon Tag -->
            <div>
                <label for="amazonTag" class="block text-sm font-medium text-gray-300 mb-1">3. Amazon Associate ID (e.g., yourtag-20)</label>
                <input type="text" id="amazonTag" name="amazonTag" placeholder="Amazon Tag (e.g., yourtag-20)" class="w-full px-4 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150">
            </div>

            <!-- Email -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-300 mb-1">4. Contact Email Address</label>
                <input type="email" id="email" name="email" placeholder="contact@example.com" required class="w-full px-4 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150">
            </div>

            <!-- Submission Button -->
            <button type="submit" id="submitButton" class="w-full py-3 mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-lg transition duration-150 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-blue-500/50">
                Register Site & Proceed to Stripe
            </button>

            <!-- Status Message Area -->
            <div id="statusMessage" class="p-3 text-center rounded-lg font-medium hidden" role="alert"></div>
            
            <!-- Hidden Input for GAS URL -->
            <input type="hidden" id="gasUrlInput" value="YOUR_GOOGLE_APPS_SCRIPT_URL_HERE">

        </form>
    </div>

    <script>
        // Set the GAS URL here - THIS MUST BE UPDATED AFTER EACH DEPLOYMENT!
        // This is the URL from the 'Web app' deployment of your Google Apps Script.
        // It must point to the deployment running as 'User accessing the web app'.
        const GAS_WEB_APP_URL = document.getElementById('gasUrlInput').value;

        const form = document.getElementById('onboardingForm');
        const submitButton = document.getElementById('submitButton');
        const statusMessage = document.getElementById('statusMessage');

        /**
         * Utility function to display a status message.
         * @param {string} message The text message to display.
         * @param {string} type The type of message ('success', 'error', 'loading').
         */
        function displayStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden', 'bg-red-200', 'text-red-800', 'bg-green-200', 'text-green-800', 'bg-gray-200', 'text-gray-800');
            
            submitButton.disabled = type === 'loading';

            switch (type) {
                case 'success':
                    statusMessage.classList.add('bg-green-200', 'text-green-800');
                    break;
                case 'error':
                    statusMessage.classList.add('bg-red-200', 'text-red-800');
                    break;
                case 'loading':
                    statusMessage.classList.add('bg-gray-200', 'text-gray-800');
                    break;
                default:
                    statusMessage.classList.add('bg-gray-200', 'text-gray-800');
            }
        }

        /**
         * The JSONP callback function that the Google Apps Script will call.
         * @param {Object} response The JSON object returned by the server script.
         */
        window.handleGasResponse = function(response) {
            // Remove the temporary script tag used for the request
            const script = document.getElementById('gasScript');
            if (script) {
                script.remove();
            }
            
            if (response.status === 'success') {
                displayStatus(`Success! Tenant ID: ${response.tenantId}. Proceeding to payment...`, 'success');
                // Simulate redirect to Stripe/Payment Gateway
                console.log("Simulating redirect to Stripe for Tenant ID:", response.tenantId);
                // In a real app, you would redirect to a payment page here.
                // window.location.href = `https://stripe.com/checkout?tenant=${response.tenantId}`; 
            } else {
                displayStatus(`Registration Error: ${response.message}. Please try again.`, 'error');
                console.error("GAS Error:", response.message);
            }
        };


        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // Reset status message
            displayStatus('Processing...', 'loading');

            const data = {
                displayName: document.getElementById('displayName').value,
                domainName: document.getElementById('domainName').value.replace(/^\/+/, ''), // Clean leading slash
                amazonTag: document.getElementById('amazonTag').value,
                email: document.getElementById('email').value
            };

            // 1. Serialize the data into a URL-safe string
            const payload = encodeURIComponent(JSON.stringify(data));
            
            // 2. Construct the JSONP URL
            // GAS_WEB_APP_URL must end in /exec or /dev
            const url = `${GAS_WEB_APP_URL}?payload=${payload}&callback=handleGasResponse`;

            // 3. Create a dynamic script tag (JSONP technique)
            const script = document.createElement('script');
            script.src = url;
            script.id = 'gasScript';
            
            // 4. Handle connection errors that prevent the script from loading
            script.onerror = function() {
                displayStatus("Connection Error! Please check your network and ensure the GAS script is deployed correctly.", 'error');
                // Clean up the script tag if an error occurs
                if (script) {
                    script.remove();
                }
            };

            // 5. Inject the script into the document head to execute the JSONP request
            document.head.appendChild(script);
        });

        // Set up the default GAS URL from the input field on load
        document.getElementById('gasUrlInput').value = "https://script.google.com/macros/s/AKfycbwJuuLRZtsy2rshiTX44GcgjKFnumjoA-aKH_7OtbLUY2RQlgfszNN6JCS73GsGILJ.../exec"; // Placeholder URL
        displayStatus("Please update the GAS URL above with your actual deployment URL.", 'error');

    </script>
</body>
</html>
