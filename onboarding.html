<!-- 
  This HTML/JavaScript file demonstrates how to correctly submit form data 
  as JSON using the modern 'fetch' API, which is the preferred method for 
  talking to a GAS Web App endpoint. 
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onboarding Form</title>
    <!-- Load Tailwind CSS for quick styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .container {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen">
    <div class="container w-full max-w-md bg-white p-8 rounded-xl shadow-2xl">
        <h2 class="text-3xl font-bold mb-6 text-gray-900 text-center">New Client Onboarding</h2>
        <form id="onboardingForm" class="space-y-4">
            <div>
                <label for="companyName" class="block text-sm font-medium text-gray-700">Company Name</label>
                <input type="text" id="companyName" required
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div>
                <label for="contactEmail" class="block text-sm font-medium text-gray-700">Contact Email</label>
                <input type="email" id="contactEmail" required
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div>
                <label for="serviceTier" class="block text-sm font-medium text-gray-700">Service Tier</label>
                <select id="serviceTier" required
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">Select a tier</option>
                    <option value="Basic">Basic</option>
                    <option value="Pro">Pro</option>
                    <option value="Enterprise">Enterprise</option>
                </select>
            </div>
            <button type="submit" id="submitButton"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                Submit Onboarding
            </button>
            <p id="message" class="text-center text-sm mt-4 hidden"></p>
        </form>
    </div>

    <script>
        // *** IMPORTANT: REPLACE THIS PLACEHOLDER WITH YOUR DEPLOYED GAS WEB APP URL ***
        const GAS_WEB_APP_URL = 'YOUR_DEPLOYED_GAS_WEB_APP_URL_HERE';

        const form = document.getElementById('onboardingForm');
        const messageEl = document.getElementById('message');
        const submitButton = document.getElementById('submitButton');

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            submitButton.disabled = true;
            messageEl.textContent = 'Submitting data...';
            messageEl.classList.remove('hidden', 'text-red-500', 'text-green-500');
            messageEl.classList.add('text-blue-500');

            // 1. Collect form data into a plain JavaScript object
            const formData = {
                companyName: document.getElementById('companyName').value,
                contactEmail: document.getElementById('contactEmail').value,
                serviceTier: document.getElementById('serviceTier').value,
                timestamp: new Date().toISOString()
            };

            try {
                // 2. Use fetch to send the data
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    // 3. CRITICAL: Send the data as JSON
                    headers: {
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(formData) // Convert JS object to JSON string
                });

                // 4. Check for successful response status
                if (response.ok) {
                    const result = await response.json();
                    if (result.status === 'SUCCESS') {
                        messageEl.textContent = 'Success! Client data recorded.';
                        messageEl.classList.replace('text-blue-500', 'text-green-500');
                        form.reset();
                        // You would typically redirect the user to Stripe checkout here
                        // window.location.href = '/checkout-page?tier=' + formData.serviceTier; 
                    } else {
                        // Handle success status but application-level error (e.g., validation fail)
                         messageEl.textContent = 'Submission failed: ' + (result.message || 'Unknown server error.');
                         messageEl.classList.replace('text-blue-500', 'text-red-500');
                    }
                } else {
                    // Handle HTTP error statuses (400s, 500s)
                    throw new Error(`Server returned status: ${response.status} ${response.statusText}`);
                }

            } catch (error) {
                console.error('Submission Error:', error);
                messageEl.textContent = 'Connection Error: Could not reach the server or invalid response. Check console for details.';
                messageEl.classList.replace('text-blue-500', 'text-red-500');
            } finally {
                submitButton.disabled = false;
                messageEl.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
