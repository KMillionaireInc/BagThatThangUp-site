<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.querySelector("form");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const data = {
      tenant_id: crypto.randomUUID(),
      site_display_name: form.querySelector("[name='site_display_name']").value.trim(),
      subdomain: form.querySelector("[name='subdomain']").value.trim().toLowerCase(),
      amazon_tag: form.querySelector("[name='amazon_tag']").value.trim(),
      email: form.querySelector("[name='email']").value.trim(),
    };

    const webhookUrl = "https://hook.us2.make.com/yg89x1wsy0stc70m6jqgrbtllz9e6x80"; // your Make webhook

    try {
      const response = await fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await response.json();
      console.log("Webhook response:", result);

      if (result.error) {
        document.body.innerHTML = `
          <div style="text-align:center;padding:3rem;font-family:sans-serif">
            <h2>That site name is already taken.</h2>
            <p>Please choose another subdomain.</p>
            <button onclick="window.history.back()">Go Back</button>
          </div>`;
      } else {
        const liveLink = result.subdomain
          ? \`https://\${result.subdomain}.bagthatthangup.com\`
          : null;

        document.body.innerHTML = `
          <div style="text-align:center;padding:3rem;font-family:sans-serif">
            <h1>ðŸŽ‰ Your Site Is Live!</h1>
            <p>Congratulations â€” your affiliate storefront has been created!</p>
            <p><strong>Your link:</strong></p>
            <a href="\${liveLink || '#'}" target="_blank">
              \${liveLink ? liveLink : 'Site not detected'}
            </a>
            <p>Share your link across your platforms to start earning!</p>
          </div>`;
      }
    } catch (err) {
      console.error(err);
      document.body.innerHTML = `
        <div style="text-align:center;padding:3rem;font-family:sans-serif">
          <h2>Server error â€” please try again.</h2>
        </div>`;
    }
  });
});
</script>
