<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="pageTitle">Your Site — BagThat</title>
<meta name="description" content="Daily Amazon promo codes & curated deals. As an Amazon Associate I earn from qualifying purchases.">
<link rel="icon" href="/favicon.png" sizes="32x32">

<style>
  :root{
    --brand:#0f915a;
    --accent:#1e90ff;
    --ink:#0b1320;
    --muted:#4d6375;
    --line:#e8eef5;
    --surface:#fff;
    --bg:#f6faf9;
    --btn:#0f915a;
    --btn-ink:#fff;
    --shadow:0 10px 26px rgba(2,24,43,.12);
  }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  a{color:inherit;text-decoration:none}
  img{display:block;max-width:100%}

  .disclosure-bar{
    position:sticky;top:0;z-index:999;
    background:#0f915a;color:#fff;
    text-align:center;font-size:13px;
    font-weight:700;padding:8px 12px;
  }

  .hero{
    background:linear-gradient(135deg,var(--brand),var(--accent));
    color:#fff;border-bottom:1px solid #dff1f3;
  }
  .hero .inner{max-width:1200px;margin:0 auto;padding:16px;display:grid;gap:14px;grid-template-columns:64px 1fr}
  .avatar{width:64px;height:64px;border-radius:999px;border:2px solid rgba(255,255,255,.9);object-fit:cover;background:#fff}
  @media (max-width:640px){.hero .inner{grid-template-columns:52px 1fr}.avatar{width:52px;height:52px}}
  .h1{margin:0;font-size:clamp(22px,2.4vw,34px);font-weight:900}
  .sub{margin:4px 0 8px;color:#fffbe7;font-size:14px;line-height:1.4}
  .actions{display:flex;gap:10px;flex-wrap:wrap}
  .pill{background:#fff;color:#083663;border:1px solid #d9e7ff;padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer}
  .pill.primary{background:#083663;color:#fff;border-color:#083663}

  .toolbar{position:sticky;top:40px;z-index:80;background:#f6faf9cc;backdrop-filter:saturate(160%) blur(10px);border-bottom:1px solid #e8eef5}
  .toolbar .wrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:grid;gap:10px}
  .toolbar-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .search{flex:1;min-width:220px;background:#fff;border:1px solid var(--line);border-radius:999px;display:flex;gap:8px;padding:10px 14px;box-shadow:0 6px 14px rgba(2,24,43,.06)}
  .search input{border:0;outline:0;flex:1;font-size:15px;color:#0d2530}
  .select{min-width:170px;background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-weight:700;color:#083663}
  .ghost{padding:10px 12px;border-radius:10px;background:#e9f8f7;border:1px solid #cfeeee;font-weight:800;cursor:pointer}

  .wrap{max-width:1200px;margin:0 auto;padding:0 16px}
  .grid{display:grid;gap:16px;margin:16px 0 36px}
  @media(max-width:599px){.grid{grid-template-columns:1fr}}
  @media(min-width:600px){.grid{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}}
  .list .card{flex-direction:row;align-items:center;height:auto}
  .list .media{width:160px;height:160px;flex-shrink:0}
  .list .body{flex:1}

  .card{background:var(--surface);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;transition:transform .08s ease, box-shadow .2s ease}
  .card:hover{transform:translateY(-2px);box-shadow:0 16px 36px rgba(2,24,43,.16)}
  .media{background:#fff;border-bottom:1px solid var(--line);display:flex;justify-content:center;align-items:center;overflow:hidden;padding:10px;height:260px}
  .body{padding:12px}
  .title-line{font-size:15px;font-weight:800;line-height:1.25;margin:2px 0 6px;min-height:38px}
  .deal-price{color:#0c6e53;font-weight:900;font-size:18px}
  .original-price{color:#999;text-decoration:line-through;font-size:13px;margin-left:8px}
  .actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
  .btn{display:inline-block;text-align:center;padding:12px;border-radius:12px;border:1px solid #0b7247;background:var(--btn);color:var(--btn-ink);font-weight:900}
  .btn-code{background:#fff;color:#083663;border:1px solid #cfeeee;font-weight:900;text-align:center;padding:12px;border-radius:12px}
  .empty{text-align:center;color:#4e6a79;padding:40px 16px;display:none}

  footer{color:#4e6a79;border-top:1px solid #e8eef5;padding:24px 0;margin-top:20px;text-align:center;font-size:13px}
</style>
</head>

<body>
<div class="disclosure-bar">As an Amazon Associate I earn from qualifying purchases.</div>

<header class="hero">
  <div class="inner">
    <img id="logo" class="avatar" src="https://via.placeholder.com/64x64.png?text=Logo" alt="Store Logo">
    <div>
      <h1 class="h1" id="storeName">Store Name</h1>
      <p class="sub">Curated daily Amazon deals, refreshed daily.</p>
      <div class="actions" id="buttons">
        <button class="pill primary tab" data-src="today">Today's Deals</button>
        <button class="pill tab" data-src="yesterday">Yesterday's Finds</button>
        <button class="pill tab" data-src="almost">Almost Gone</button>
      </div>
    </div>
  </div>
</header>

<div class="toolbar">
  <div class="wrap">
    <div class="toolbar-row">
      <div class="search"><input id="search" type="search" placeholder="Search deals…"/></div>
      <select id="sort" class="select">
        <option value="newest">Newest</option>
        <option value="pricelow">Price: Low → High</option>
        <option value="pricehigh">Price: High → Low</option>
      </select>
      <button id="reset" class="ghost">Reset</button>
    </div>
  </div>
</div>

<main id="main" class="wrap">
  <div id="grid" class="grid"><p>Loading deals…</p></div>
  <div id="empty" class="empty">No deals found.</div>
</main>

<footer>
  © 2025 • Powered by BagThat
</footer>

<script>
const TENANT_SHEET = "https://script.google.com/macros/s/AKfycbytm-ntU4HHZq4PDXpwr4qoflZUy8Hcg-7GFLT0RFUJGuKIG0Zy3lIDEYTRBt7UVqkK/exec";
const DEALS_BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR_hOlderdV0ABENcLrWMZFl8zXEqXii-3TnA55f13uVNMArQJjDw9OskRH1gLLQLIivHl5zOeH0yKb/pub?gid=0&single=true&output=csv";

const params = new URLSearchParams(location.search);
const site = params.get("site");

async function loadTenant() {
  const res = await fetch(`${TENANT_SHEET}?site=${encodeURIComponent(site)}&callback=cb`);
  const text = await res.text();
  const json = JSON.parse(text.replace(/^cb\(|\)$/g, ""));
  const t = json.tenant || {};
  if (!t) return;

  // apply customization
  document.getElementById("storeName").textContent = t.site_display_name || site;
  document.title = `${t.site_display_name || site} — BagThat`;
  if (t.logo_url) document.getElementById("logo").src = t.logo_url;
  if (t.color_primary) document.documentElement.style.setProperty("--brand", t.color_primary);
  if (t.color_secondary) document.documentElement.style.setProperty("--accent", t.color_secondary);
  if (t.extra_button_label && t.extra_button_url) {
    const b = document.createElement("a");
    b.href = t.extra_button_url; b.target="_blank";
    b.className="pill"; b.textContent=t.extra_button_label;
    document.getElementById("buttons").appendChild(b);
  }
  if (t.layout === "list") document.getElementById("grid").classList.add("list");
}

async function loadDeals() {
  const res = await fetch(DEALS_BASE);
  const csv = await res.text();
  const rows = csv.split("\n").slice(1).map(r => r.split(","));
  const list = rows.filter(r=>r[0]).map(r=>({
    Title:r[12],Price:r[2],OriginalPrice:r[21]||"",PromoCode:r[3],Link:r[6],Image:r[1]
  }));
  render(list);
}

function money(n){return "$"+parseFloat(n||0).toFixed(2);}
function render(list){
  const grid=document.getElementById("grid"), empty=document.getElementById("empty");
  if(!list.length){grid.innerHTML="";empty.style.display="block";return;}
  empty.style.display="none";
  grid.innerHTML=list.map(d=>`
    <article class="card">
      <div class="media"><img src="${d.Image||'https://via.placeholder.com/200x200.png?text=Deal'}" alt="${d.Title}"></div>
      <div class="body">
        <div class="title-line">${d.Title}</div>
        <div><span class="deal-price">${money(d.Price)}</span>
        ${d.OriginalPrice?`<span class="original-price">${money(d.OriginalPrice)}</span>`:""}</div>
        <div class="actions">
          <button class="btn-code" onclick="navigator.clipboard.writeText('${d.PromoCode}')">Copy Code</button>
          <a class="btn" href="${d.Link}" target="_blank">Shop</a>
        </div>
      </div>
    </article>`).join("");
}

document.addEventListener("DOMContentLoaded", async ()=>{
  await loadTenant();
  await loadDeals();
});
</script>
</body>
</html>
