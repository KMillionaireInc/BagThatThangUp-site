<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Deals · Custom Site</title>
<meta name="description" content="Daily Amazon promo codes, coupons & curated finds. As an Amazon Associate I earn from qualifying purchases.">
<link rel="icon" href="/favicon.png" sizes="32x32">

<style>
  :root{
    --brand:#0ea5a6;
    --accent:#1e90ff;
    --ink:#0b1320;
    --muted:#4d6375;
    --line:#e8eef5;
    --surface:#fff;
    --bg:#f6faf9;
    --btn:#0f915a;
    --btn-ink:#fff;
    --shadow:0 10px 26px rgba(2,24,43,.12);
  }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  a{color:inherit;text-decoration:none}
  img{display:block;max-width:100%}

  /* Disclosure */
  .disclosure-bar{
    background:#fff8e1;
    border-bottom:1px solid #f0e0b0;
    color:#664d03;
    text-align:center;
    font-size:13px;
    font-weight:700;
    padding:8px 12px;
  }

  /* Header */
  .hero{
    background:linear-gradient(135deg,var(--brand),var(--accent));
    color:#fff;
    border-bottom:1px solid #dff1f3;
  }
  .hero .inner{max-width:1200px;margin:0 auto;padding:16px;display:grid;gap:14px;grid-template-columns:64px 1fr}
  .avatar{width:64px;height:64px;border-radius:999px;border:2px solid rgba(255,255,255,.9);object-fit:cover;background:#fff}
  @media (max-width:640px){.hero .inner{grid-template-columns:52px 1fr}.avatar{width:52px;height:52px}}
  .h1{margin:0;font-size:clamp(22px,2.4vw,34px);font-weight:900}
  .sub{margin:4px 0 8px;color:#fffbe7;font-size:14px}
  .hero .actions{display:flex;gap:10px;flex-wrap:wrap}
  .pill{background:#fff;color:#083663;border:1px solid #d9e7ff;padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer;text-align:center}
  .pill.primary{background:#083663;color:#fff;border-color:#083663}

  /* Toolbar */
  .toolbar{position:sticky;top:0;z-index:80;background:#f6faf9cc;backdrop-filter:saturate(160%) blur(10px);border-bottom:1px solid #e8eef5}
  .toolbar .wrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:grid;gap:10px}
  .toolbar-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .search{flex:1;min-width:220px;background:#fff;border:1px solid var(--line);border-radius:999px;display:flex;gap:8px;padding:10px 14px;box-shadow:0 6px 14px rgba(2,24,43,.06)}
  .search input{border:0;outline:0;flex:1;font-size:15px;color:#0d2530}
  .select{min-width:170px;background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-weight:700;color:#083663}
  .ghost{padding:10px 12px;border-radius:10px;background:#e9f8f7;border:1px solid #cfeeee;font-weight:800;cursor:pointer}

  .layout-toggle{
    display:flex;align-items:center;gap:6px;
    padding:10px 12px;background:#fff;border:1px solid #d0e3e3;
    border-radius:10px;cursor:pointer;font-weight:700;color:#083663;
  }
  .layout-toggle svg{width:18px;height:18px;stroke:#083663;stroke-width:2;fill:none}

  .wrap{max-width:1200px;margin:0 auto;padding:0 16px}

  /* Cards */
  .grid{display:grid;gap:16px;margin:16px 0 36px}
  .list .grid{display:block}
  @media(max-width:599px){.grid{grid-template-columns:1fr}}
  @media(min-width:600px){.grid{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}}

  .card{background:var(--surface);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);
        overflow:hidden;display:flex;flex-direction:column;transition:transform .08s ease,box-shadow .2s ease;margin-bottom:16px}
  .card:hover{transform:translateY(-2px);box-shadow:0 16px 36px rgba(2,24,43,.16)}
  .media{background:#fff;border-bottom:1px solid var(--line);display:flex;justify-content:center;align-items:center;overflow:hidden;padding:10px;height:260px}
  .media img{max-width:100%;max-height:100%;height:auto;width:auto;object-fit:contain}
  .body{padding:12px}
  .title-line{font-size:15px;font-weight:800;line-height:1.25;margin:2px 0 6px;min-height:38px}
  .deal-price{color:#0c6e53;font-weight:900;font-size:18px}
  .original-price{color:#999;text-decoration:line-through;font-size:13px;margin-left:8px}
  .actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
  .btn{display:inline-block;text-align:center;padding:12px;border-radius:12px;border:1px solid #0b7247;background:var(--btn);color:var(--btn-ink);font-weight:900}
  .btn-code{background:#fff;color:#083663;border:1px solid #cfeeee;font-weight:900;text-align:center;padding:12px;border-radius:12px}
  .empty{text-align:center;color:#4e6a79;padding:40px 16px;display:none}

  footer{color:#4e6a79;border-top:1px solid #e8eef5;padding:24px 0;margin-top:20px;text-align:center;font-size:13px}
</style>
</head>

<body>
  <div class="disclosure-bar">
    Daily Amazon promo codes, coupons & curated finds — As an Amazon Associate I earn from qualifying purchases. Promo codes, coupons, and prices may change at any time.
  </div>

  <header class="hero">
    <div class="inner">
      <img class="avatar" id="avatar" src="/tenant/assets/custom-badge.png" alt="Logo">
      <div>
        <h1 class="h1" id="siteName">Daily Deals</h1>
        <p class="sub">Curated daily Amazon deals, refreshed daily.</p>
        <div class="actions" id="buttons">
          <button class="pill primary tab" data-src="today">Today's Deals</button>
          <button class="pill tab" data-src="yesterday">Yesterday's Finds</button>
          <button class="pill tab" data-src="almost">Almost Gone</button>
        </div>
      </div>
    </div>
  </header>

  <div class="toolbar">
    <div class="wrap">
      <div class="toolbar-row">
        <div class="search"><input id="search" type="search" placeholder="Search deals…"/></div>
        <select id="sort" class="select">
          <option value="newest">Newest</option>
          <option value="pricelow">Price: Low → High</option>
          <option value="pricehigh">Price: High → Low</option>
        </select>
        <button id="layoutToggle" class="layout-toggle" title="Switch layout">
          <svg id="iconGrid" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          <svg id="iconList" viewBox="0 0 24 24" style="display:none"><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
        </button>
        <button id="reset" class="ghost">Reset</button>
      </div>
    </div>
  </div>

  <main id="main" class="wrap">
    <div id="grid" class="grid"><p>Loading deals…</p></div>
    <div id="empty" class="empty">No deals found.</div>
  </main>

  <footer>
    © 2025 — Powered by <b>BagThat</b>
  </footer>

<script>
(async function(){
  const CSV_TODAY="https://docs.google.com/spreadsheets/d/e/2PACX-1vS8B3eTxf5t0-v2m2NNicpty89ci6LRrJlGnwauS0sLZa8VyAjpnHI1h15s0le8hEsqRbcS9BB0VwFm/pub?gid=23655256&single=true&output=csv";
  const CSV_YESTERDAY="https://docs.google.com/spreadsheets/d/e/2PACX-1vS8B3eTxf5t0-v2m2NNicpty89ci6LRrJlGnwauS0sLZa8VyAjpnHI1h15s0le8hEsqRbcS9BB0VwFm/pub?gid=1955863351&single=true&output=csv";
  const CSV_ALMOST="https://docs.google.com/spreadsheets/d/e/2PACX-1vS8B3eTxf5t0-v2m2NNicpty89ci6LRrJlGnwauS0sLZa8VyAjpnHI1h15s0le8hEsqRbcS9BB0VwFm/pub?gid=499142778&single=true&output=csv";
  const SUBS="https://docs.google.com/spreadsheets/d/e/2PACX-1vR_hOlderdV0ABENcLrWMZFl8zXEqXii-3TnA55f13uVNMArQJjDw9OskRH1gLLQLIivHl5zOeH0yKb/pub?gid=0&single=true&output=csv";

  const $=s=>document.querySelector(s);
  const grid=$("#grid"), empty=$("#empty"), avatar=$("#avatar"), siteName=$("#siteName"), buttons=$("#buttons");

  function parseCSV(t){const r=[],e=t.split(/\r?\n/);for(const n of e){if(!n.trim())continue;r.push(n.split(","))}return r}
  function toObjects(r){const h=r.shift();return r.map(x=>Object.fromEntries(h.map((k,i)=>[k,x[i]||""])))}  
  async function getCSV(u){const r=await fetch(u);return toObjects(parseCSV(await r.text()))}

  const sub=location.hostname.split(".")[0].toLowerCase();
  const tenants=await getCSV(SUBS);
  const me=tenants.find(r=>r.subdomain?.toLowerCase()===sub);
  if(me){
    siteName.textContent=me.site_display_name||sub;
    if(me.logo_url) avatar.src=me.logo_url;
    if(me.color_primary) document.documentElement.style.setProperty("--brand",me.color_primary);
    if(me.color_secondary) document.documentElement.style.setProperty("--accent",me.color_secondary);
    if(me.extra_button_label&&me.extra_button_url){
      const btn=document.createElement("a");
      btn.className="pill";
      btn.href=me.extra_button_url;
      btn.target="_blank";
      btn.textContent=me.extra_button_label;
      buttons.appendChild(btn);
    }
  }

  const TAG=me?.amazon_tag||"";
  let CURRENT="today";

  const money=n=>"$"+parseFloat(n).toFixed(2);
  const gridEl=$("#grid");

  function buildCard(d){
    const img=(d.ImageURL_raw||d.ImageURL_clean||d.ImageURL_generated||"").replace(/^http:/,"https:");
    const promo=(d.PromoCode||"").trim();
    const deal=money(d.DiscountPrice||d.Price||0);
    const orig=d.OriginalPrice?`<span class='original-price'>${money(d.OriginalPrice)}</span>`:"";
    const link=d.TaggedLink||d.Link||"#";
    const tagged=TAG?link.replace(/(tag=[^&]*)?/,"tag="+TAG):link;
    return `<article class="card">
      <div class="media">${img?`<img src="${img}" alt="${d.Title}">`:""}</div>
      <div class="body">
        <div class="title-line">${d.Title}</div>
        <div><span class="deal-price">${deal}</span>${orig}</div>
        <div class="actions">
          ${promo?`<button class="btn-code" onclick="navigator.clipboard.writeText('${promo}')">Copy Code</button>`:""}
          <a class="btn" href="${tagged}" target="_blank">Shop</a>
        </div>
      </div>
    </article>`;
  }

  async function loadDeals(src){
    const map={today:CSV_TODAY,yesterday:CSV_YESTERDAY,almost:CSV_ALMOST};
    const data=await getCSV(map[src]);
    gridEl.innerHTML=data.map(buildCard).join("");
  }

  document.addEventListener("DOMContentLoaded",()=>{
    document.querySelectorAll(".tab").forEach(b=>b.addEventListener("click",()=>{CURRENT=b.dataset.src;loadDeals(CURRENT);document.querySelectorAll(".tab").forEach(x=>x.classList.toggle("primary",x===b));}));
  });

  // Layout toggle
  const toggle=$("#layoutToggle"), iconGrid=$("#iconGrid"), iconList=$("#iconList");
  function setLayout(mode){
    document.body.classList.toggle("list",mode==="list");
    iconGrid.style.display=mode==="grid"?"none":"block";
    iconList.style.display=mode==="grid"?"block":"none";
    sessionStorage.setItem("layoutMode",mode);
  }
  let layout=sessionStorage.getItem("layoutMode")||(me?.layout||"grid");
  setLayout(layout);
  toggle.addEventListener("click",()=>setLayout(layout=layout==="grid"?"list":"grid"));

  loadDeals("today");
})();
</script>
</body>
</html>
